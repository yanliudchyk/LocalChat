# Требования к проекту LocalChat
---

# Содержание
1 [Введение](#intro)  
1.1 [Назначение](#appointment)  
1.2 [Бизнес-требования](#business_requirements)  
1.2.1 [Исходные данные](#initial_data)  
1.2.2 [Границы проекта](#project_boundary)  
1.3 [Аналоги](#analogues)  
2 [Требования пользователя](#user_requirements)  
2.1 [Программные интерфейсы](#software_interfaces)  
2.2 [Интерфейс пользователя](#user_interface)  
2.3 [Характеристики пользователей](#user_specifications)  
3 [Системные требования](#system_requirements)  
3.1 [Функциональные требования](#functional_requirements)  
3.1.1 [Управление настройками и подключением](#settings_and_connection)  
3.1.2 [Обмен сообщениями](#messaging)  
3.1.3 [Сетевая логика (TCP)](#network_logic)  
3.2 [Нефункциональные требования](#non-functional_requirements)  

<a name="intro"/>

# 1 Введение

<a name="appointment"/>

## 1.1 Назначение
Документ описывает требования к Android-приложению **LocalChat** для обмена текстовыми сообщениями в локальной сети (LAN) без доступа к интернету. Приложение реализует клиент-серверную архитектуру на мобильных устройствах.

<a name="business_requirements"/>

## 1.2 Бизнес-требования

<a name="initial_data"/>

### 1.2.1 Исходные данные
Необходим инструмент для оперативной связи в замкнутых группах (офис, учебный класс, поездка), где интернет либо отсутствует, либо его использование нежелательно по соображениям безопасности/экономии.

<a name="project_boundary"/>

### 1.2.2 Границы проекта
- **Роли**: Устройство может выступать в роли Сервера (Хоста) или Клиента.
- **Сеть**: Работа только в пределах одной подсети Wi-Fi.
- **Данные**: История чата хранится только в оперативной памяти (RAM) и стирается при перезапуске или смене настроек. Настройки сохраняются персистентно.

<a name="analogues"/>

## 1.3 Аналоги
Bluetooth Chat, LAN Messenger.  
**Отличие LocalChat**: Использование стандартных TCP/IP сокетов, современный UI (Compose), простота настройки (IP:Port).

<a name="user_requirements"/>

# 2 Требования пользователя

<a name="software_interfaces"/>

## 2.1 Программные интерфейсы
- **Язык**: Kotlin.
- **UI Framework**: Jetpack Compose.
- **Архитектура**: MVVM, Clean Architecture.
- **Dependency Injection**: Hilt.
- **Асинхронность**: Coroutines, Flow (StateFlow/SharedFlow).
- **Сеть**: `java.net.Socket`, `java.net.ServerSocket` (TCP).
- **Хранение настроек**: SharedPreferences.

<a name="user_interface"/>

## 2.2 Интерфейс пользователя
Приложение состоит из одного Activity с перекрывающими поверхностями:
1.  **Экран чата (Основной)**:
    * Верхняя панель с заголовком и кнопкой "Настройки" (иконка шестеренки).
    * Список сообщений, прижатый к низу.
    * Поле ввода и кнопка отправки.
2.  **Диалог настроек (Modal)**:
    * Выбор роли: Сервер / Клиент.
    * Поле ввода "Имя пользователя".
    * Поле ввода "IP сервера" (скрыто или заблокировано в режиме Сервера, если сервер всегда слушает локальный IP, либо доступно для клиентов).
    * Поле ввода "Порт".
    * Кнопка "Сохранить и переподключиться".

<a name="user_specifications"/>

## 2.3 Характеристики пользователей
| Роль | Обязанности |
|:---|:---|
| **Хост (Сервер)** | Запускает `ServerSocket`. Принимает подключения от N клиентов. Ретранслирует полученные сообщения всем участникам. |
| **Клиент** | Инициирует подключение к Хосту по IP:Port. Отправляет сообщения на сервер, слушает входящий поток сообщений от сервера. |

<a name="system_requirements"/>

# 3 Системные требования

<a name="functional_requirements"/>

## 3.1 Функциональные требования

<a name="settings_and_connection"/>

### 3.1.1 Управление настройками и подключением
| ID | Функция | Описание |
|:---|:---|:---|
| FR-01 | Сохранение настроек | Настройки (Роль, Ник, IP, Порт) должны сохраняться между запусками приложения. |
| FR-02 | Реактивное подключение | При сохранении новых настроек текущая сетевая сессия должна закрываться, история очищаться, и инициироваться новое подключение/создание сервера. |
| FR-03 | Валидация | Порт должен быть числом в диапазоне 1024–65535. Никнейм не пустой. |

<a name="messaging"/>

### 3.1.2 Обмен сообщениями
| ID | Функция | Описание |
|:---|:---|:---|
| FR-04 | Отправка | Сообщение отправляется на сервер в фоновом потоке. UI обновляется оптимистично (сразу отображается у отправителя). |
| FR-05 | Прием | Входящие сообщения добавляются в список в реальном времени. |
| FR-06 | Формат | Сообщение содержит: `timestamp`, `username`, `text`. |

<a name="network_logic"/>

### 3.1.3 Сетевая логика (TCP)
**Режим Сервера:**
1.  Открыть `ServerSocket` на указанном порту.
2.  В цикле `accept()` принимать новые подключения.
3.  Хранить список активных сокетов (клиентов) в поточно-безопасной коллекции (`ConcurrentHashMap`).
4.  При получении сообщения от клиента `A`, переслать его клиентам `B, C, D...` (всем, кроме `A`).
5.  При ошибке записи в сокет клиента — удалять его из списка.

**Режим Клиента:**
1.  Создать `Socket` и подключиться к `IP:Port`.
2.  Слушать `InputStream` в бесконечном цикле на предмет входящих сообщений.
3.  При разрыве соединения уведомлять пользователя (Toast/Snackbar) или пробовать переподключиться.

<a name="non-functional_requirements"/>

## 3.2 Нефункциональные требования
1.  **Производительность**: Сетевые операции (IO) строго в `Dispatchers.IO`. UI не должен блокироваться.
2.  **Ресурсоемкость**: Корректное закрытие сокетов (`close()`) при смене настроек или закрытии приложения во избежание утечек портов ("Address already in use").
3.  **Совместимость**: Android SDK 26+ (Android 8.0).
4.  **Безопасность**: Данные передаются в открытом виде (без SSL/TLS), что допустимо для учебного проекта в доверенной LAN.